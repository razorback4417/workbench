<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flux SDK Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #1a1a1a;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .test-section {
      margin: 30px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 6px;
      border-left: 4px solid #6366f1;
    }
    .test-section h2 {
      margin-top: 0;
      color: #1a1a1a;
    }
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #4f46e5;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .output {
      margin-top: 15px;
      padding: 15px;
      background: #1a1a1a;
      color: #00ff00;
      border-radius: 6px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .success {
      color: #00ff00;
    }
    .error {
      color: #ff4444;
    }
    .info {
      color: #00aaff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ Flux SDK Test</h1>
    <p class="subtitle">Test the Flux SDK functionality in your browser</p>

    <div class="test-section">
      <h2>1. List Prompts</h2>
      <p>Get all available prompts from the registry</p>
      <button onclick="testListPrompts()">Run Test</button>
      <div id="output-list" class="output" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h2>2. Get Prompt by ID</h2>
      <p>Fetch a specific prompt (using first available prompt)</p>
      <button onclick="testGetPrompt()">Run Test</button>
      <div id="output-get" class="output" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h2>3. Run a Prompt</h2>
      <p>Execute a prompt with variables (using first available prompt)</p>
      <button onclick="testRunPrompt()">Run Test</button>
      <div id="output-run" class="output" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h2>4. Create a Prompt</h2>
      <p>Create a new prompt via SDK</p>
      <button onclick="testCreatePrompt()">Run Test</button>
      <div id="output-create" class="output" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h2>5. List Logs</h2>
      <p>Get execution logs</p>
      <button onclick="testListLogs()">Run Test</button>
      <div id="output-logs" class="output" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h2>6. List Evaluations</h2>
      <p>Get all evaluation runs</p>
      <button onclick="testListEvals()">Run Test</button>
      <div id="output-evals" class="output" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h2>7. List A/B Tests</h2>
      <p>Get all A/B tests</p>
      <button onclick="testListABTests()">Run Test</button>
      <div id="output-abtests" class="output" style="display: none;"></div>
    </div>
  </div>

  <script type="module">
    import { FluxClient } from '../sdk/index.js';

    // Initialize SDK
    window.flux = new FluxClient();

    // Helper to display output
    window.showOutput = function(id, message, type = 'info') {
      const output = document.getElementById(id);
      output.style.display = 'block';
      const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
      output.innerHTML = `<span class="${colorClass}">${message}</span>`;
    };

    // Test functions
    window.testListPrompts = async function() {
      try {
        showOutput('output-list', 'Loading prompts...', 'info');
        const prompts = await window.flux.prompts.list();
        showOutput('output-list',
          `‚úÖ Found ${prompts.length} prompts:\n\n` +
          prompts.map(p => `- ${p.name} (${p.id})\n  ${p.description}`).join('\n\n'),
          'success'
        );
      } catch (error) {
        showOutput('output-list', `‚ùå Error: ${error.message}`, 'error');
      }
    };

    window.testGetPrompt = async function() {
      try {
        showOutput('output-get', 'Loading prompt...', 'info');
        const prompts = await window.flux.prompts.list();
        if (prompts.length === 0) {
          showOutput('output-get', '‚ùå No prompts available. Create one first.', 'error');
          return;
        }
        const prompt = await window.flux.prompts.get(prompts[0].id);
        if (prompt) {
          showOutput('output-get',
            `‚úÖ Prompt: ${prompt.name}\n` +
            `ID: ${prompt.id}\n` +
            `Description: ${prompt.description}\n` +
            `Versions: ${prompt.versions.length}\n` +
            `Active Version: ${prompt.activeVersionId}\n` +
            `Variables: ${prompt.versions[0]?.variables.join(', ') || 'none'}`,
            'success'
          );
        } else {
          showOutput('output-get', '‚ùå Prompt not found', 'error');
        }
      } catch (error) {
        showOutput('output-get', `‚ùå Error: ${error.message}`, 'error');
      }
    };

    window.testRunPrompt = async function() {
      try {
        showOutput('output-run', 'Running prompt...', 'info');
        const prompts = await window.flux.prompts.list();
        if (prompts.length === 0) {
          showOutput('output-run', '‚ùå No prompts available. Create one first.', 'error');
          return;
        }

        const prompt = prompts[0];
        const version = prompt.versions[0];
        if (!version || version.variables.length === 0) {
          showOutput('output-run',
            `‚ö†Ô∏è Prompt "${prompt.name}" has no variables. Creating test variables...`,
            'info'
          );
        }

        // Create sample variables
        const variables = {};
        version.variables.forEach(v => {
          variables[v] = `Sample ${v} value`;
        });

        const response = await window.flux.prompts.run(prompt.id, variables);
        showOutput('output-run',
          `‚úÖ Prompt executed successfully!\n\n` +
          `Response: ${response.text.substring(0, 200)}${response.text.length > 200 ? '...' : ''}\n\n` +
          `Latency: ${response.latency}ms\n` +
          `Cost: $${response.cost.toFixed(4)}\n` +
          `Tokens: ${response.tokens}\n` +
          `Status: ${response.status}`,
          'success'
        );
      } catch (error) {
        showOutput('output-run', `‚ùå Error: ${error.message}`, 'error');
      }
    };

    window.testCreatePrompt = async function() {
      try {
        showOutput('output-create', 'Creating prompt...', 'info');
        const prompt = await window.flux.prompts.create({
          name: 'SDK Test Prompt',
          description: 'A test prompt created via SDK',
          template: 'You are a helpful assistant. User says: {{user_message}}\n\nRespond helpfully:',
          variables: ['user_message'],
          model: 'gemini-2.5-flash',
          temperature: 0.7,
          tags: ['test', 'sdk'],
          commitMessage: 'Created via SDK test'
        });
        showOutput('output-create',
          `‚úÖ Prompt created successfully!\n\n` +
          `ID: ${prompt.id}\n` +
          `Name: ${prompt.name}\n` +
          `Version: ${prompt.versions[0].version}\n` +
          `Status: ${prompt.versions[0].status}`,
          'success'
        );
      } catch (error) {
        showOutput('output-create', `‚ùå Error: ${error.message}`, 'error');
      }
    };

    window.testListLogs = async function() {
      try {
        showOutput('output-logs', 'Loading logs...', 'info');
        const logs = await window.flux.logs.list({ limit: 10 });
        showOutput('output-logs',
          `‚úÖ Found ${logs.length} logs:\n\n` +
          logs.map(log =>
            `[${new Date(log.timestamp).toLocaleString()}] ${log.status} - ${log.promptId}\n` +
            `  Latency: ${log.latency}ms, Cost: $${log.cost.toFixed(4)}, Tokens: ${log.tokens}`
          ).join('\n\n'),
          'success'
        );
      } catch (error) {
        showOutput('output-logs', `‚ùå Error: ${error.message}`, 'error');
      }
    };

    window.testListEvals = async function() {
      try {
        showOutput('output-evals', 'Loading evaluations...', 'info');
        const evals = await window.flux.evaluations.list();
        showOutput('output-evals',
          `‚úÖ Found ${evals.length} evaluations:\n\n` +
          evals.map(e =>
            `${e.name}\n` +
            `  Status: ${e.status}, Score: ${e.score}/100, Sample Size: ${e.sampleSize}`
          ).join('\n\n'),
          'success'
        );
      } catch (error) {
        showOutput('output-evals', `‚ùå Error: ${error.message}`, 'error');
      }
    };

    window.testListABTests = async function() {
      try {
        showOutput('output-abtests', 'Loading A/B tests...', 'info');
        const tests = await window.flux.abTests.list();
        showOutput('output-abtests',
          `‚úÖ Found ${tests.length} A/B tests:\n\n` +
          tests.map(t =>
            `${t.name}\n` +
            `  Status: ${t.status}\n` +
            `  Variants: ${t.variants.length}\n` +
            `  Success Rate: ${t.metrics.successRate.toFixed(1)}%`
          ).join('\n\n'),
          'success'
        );
      } catch (error) {
        showOutput('output-abtests', `‚ùå Error: ${error.message}`, 'error');
      }
    };
  </script>
</body>
</html>

